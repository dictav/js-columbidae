{"version":3,"file":"bundle.js","sources":["../src/stackdriver.js","../src/util.js","../src/sentry.js","../src/main.js"],"sourcesContent":["var baseAPIUrl = \"https://clouderrorreporting.googleapis.com/v1beta1/projects/\";\n\nfunction genV8StackMessage(err) {\n  var message = err.stack.toString();\n  console.log(message);\n  return message;\n}\n\nfunction StackDriver(config) {\n  this.url = baseAPIUrl + config.projectId + \"/events:report?key=\" + config.key;\n  this.payload = {\n    serviceContext: {\n      // https://cloud.google.com/error-reporting/reference/rest/v1beta1/ServiceContext\n      // resourceType is set automatically for incoming errors and must not be set when reporting errors. \n      service: config.service,\n      version: config.version\n    },\n    context: {\n      httpRequest: {\n        userAgent: window.navigator.userAgent,\n        url: window.location.href,\n        referrer: document.referrer,\n\n      }\n    }\n  }\n}\n\nStackDriver.prototype.send = function(err) {\n  this.payload.message = genV8StackMessage(err);\n\n  if (navigator.sendBeacon) {\n    navigator.sendBeacon(this.url, JSON.stringify(this.payload))\n    return;\n  }\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', this.url, true);\n  xhr.send(JSON.stringify(this.payload));\n}\n\nexport default StackDriver;\n","function hoge(str) {\n  return 'hoge' + str;\n}\n\nfunction piyo(str) {\n  return hoge(str) + 'piyo';\n}\n\nexport default function crash(str) {\n  throw new Error(piyo(str));\n}\n\n\nexport function extractException(err) {\n  var stacktrace = null;\n  if ('string' === typeof err.stack) {\n    stacktrace = parseStack(err.stack);\n  }\n\n  return {\n    type: 'Error',\n    value: err.message,\n    stacktrace: stacktrace\n  };\n}\n\nvar v8regexp = /at(.*) \\(?(.+):(\\d+):(\\d+)/g\nvar ffregexp = /(.*)@(.+):(\\d+):(\\d+)/g\nexport function parseStack(stack) {\n  var frames = [];\n  [v8regexp, ffregexp].forEach(function(r){\n    if (frames.length > 0) {\n      return;\n    }\n\n    var m = null;\n    while((m = r.exec(stack)) != null) {\n      var funcname = m[1].trim();\n      if (funcname.length == 0) {\n        funcname = '?';\n      }\n\n      var filename = m[2];\n      //if (filename.endsWith('.js')) {\n      //  filename = filename + ':' + m[3] + ':' + m[4];\n      //}\n\n      frames.unshift({\n        function: funcname,\n        filename: filename,\n        lineno: parseInt(m[3]),\n        colno: parseInt(m[4])\n      });\n    }\n  })\n\n  if (frames.length == 0) {\n    return null;\n  }\n\n  return { frames: frames };\n}\n","import { extractException } from './util'\n\nvar VERSION = '0.0.1';\nvar duration = 120;  // duration from start\n\nfunction Sentry(config) {\n  this.url = \"https://sentry.io/api/\" + config.projectId + \"/store/\"\n    + \"?sentry_version=7\"\n    + \"&sentry_client=simple-reporter%2F\" + VERSION\n    + \"&sentry_key=\" + config.key\n  this.payload = {\n    \"project\": config.projectId,\n    \"logger\": \"javascript\",\n    \"platform\": \"javascript\",\n    \"request\": {\n      \"headers\": {\n        \"User-Agent\": navigator.userAgent,\n      },\n      \"url\": window.location.href\n    },\n    \"exception\": {\n      \"values\": []\n    },\n    \"extra\": {\n      \"session:duration\": 0\n    }\n  }\n}\n\nSentry.prototype.send = function(err) {\n  this.payload.exception.values.push(extractException(err));\n\n  if (navigator.sendBeacon) {\n    navigator.sendBeacon(this.url, JSON.stringify(this.payload))\n    return;\n  }\n\n  console.log('sentry', this.payload);\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', this.url, true);\n  xhr.send(JSON.stringify(this.payload));\n}\n\nexport default Sentry;\n","import StackDriver from './stackdriver'\nimport Sentry from './sentry'\nimport crash from './util'\n\nfunction hello() {\n  /*@cc_on return false;@*/\n  throw new Error(\"Hello, My StackdriverJS!\");\n}\n\nexport function HelloStackDriver(config){\n  var sd = new StackDriver(config);\n  try {\n    throw new Error(\"Whats wrong!!!\");\n  } catch(err) {\n    sd.send(err);\n  }\n}\n\nexport function Crash(str) {\n  crash(str)\n}\n\nexport function HelloSentry(config, msg){\n  var st = new Sentry(config);\n  try {\n    console.log('crash');\n    crash(msg)\n  } catch(err) {\n    console.log('err', err);\n    st.send(err);\n  }\n}\n"],"names":["genV8StackMessage","err","message","stack","toString","console","log","StackDriver","config","this","url","baseAPIUrl","projectId","key","payload","serviceContext","service","version","context","httpRequest","userAgent","window","navigator","location","href","referrer","document","hoge","str","piyo","crash","Error","extractException","stacktrace","parseStack","type","value","frames","v8regexp","ffregexp","forEach","r","length","m","exec","funcname","trim","filename","unshift","function","lineno","parseInt","colno","Sentry","VERSION","project","logger","platform","request","headers","User-Agent","exception","values","extra","session:duration","prototype","send","sendBeacon","JSON","stringify","xhr","XMLHttpRequest","open","push","sd","msg","st"],"mappings":"+MAEA,SAASA,EAAkBC,GACzB,IAAIC,EAAUD,EAAIE,MAAMC,WAExB,OADAC,QAAQC,IAAIJ,GACLA,EAGT,SAASK,EAAYC,GACnBC,KAAKC,IAAMC,EAAaH,EAAOI,UAAY,sBAAwBJ,EAAOK,IAC1EJ,KAAKK,SACHC;;;AAGEC,QAASR,EAAOQ,QAChBC,QAAST,EAAOS,SAElBC,SACEC,aACEC,UAAWC,OAAOC,UAAUF,UAC5BV,IAAKW,OAAOE,SAASC,KACrBC,SAAUC,SAASD,YCrB3B,SAASE,EAAKC,GACZ,MAAO,OAASA,EAGlB,SAASC,EAAKD,GACZ,OAAOD,EAAKC,GAAO,OAGrB,SAAwBE,EAAMF,GAC5B,MAAM,IAAIG,MAAMF,EAAKD,IAIvB,SAAgBI,EAAiB/B,GAC/B,IAAIgC,EAAa,KAKjB,MAJI,iBAAoBhC,EAAIE,QAC1B8B,EAAaC,EAAWjC,EAAIE,SAI5BgC,KAAM,QACNC,MAAOnC,EAAIC,QACX+B,WAAYA,GAMhB,SAAgBC,EAAW/B,GACzB,IAAIkC,KA2BJ,OA1BCC,EAAUC,GAAUC,QAAQ,SAASC,GACpC,KAAIJ,EAAOK,OAAS,GAKpB,IADA,IAAIC,EAAI,KACqB,OAAtBA,EAAIF,EAAEG,KAAKzC,KAAiB,CACjC,IAAI0C,EAAWF,EAAE,GAAGG,OACG,GAAnBD,EAASH,SACXG,EAAW,KAGb,IAAIE,EAAWJ,EAAE;;;;AAKjBN,EAAOW,SACLC,WAAUJ,EACVE,SAAUA,EACVG,OAAQC,SAASR,EAAE,IACnBS,MAAOD,SAASR,EAAE,SAKH,GAAjBN,EAAOK,OACF,MAGAL,OAAQA,GCzDnB,SAESgB,EAAO7C,GACdC,KAAKC,IAAM,yBAA2BF,EAAOI,UAAY,4DAEf0C,EACtC,eAAiB9C,EAAOK,IAC5BJ,KAAKK,SACHyC,QAAW/C,EAAOI,UAClB4C,OAAU,aACVC,SAAY,aACZC,SACEC,SACEC,aAActC,UAAUF,WAE1BV,IAAOW,OAAOE,SAASC,MAEzBqC,WACEC,WAEFC,OACEC,mBAAoB,IFxB1B,IAAIrD,EAAa,+DA4BjBJ,EAAY0D,UAAUC,KAAO,SAASjE,GAGpC,GAFAQ,KAAKK,QAAQZ,QAAUF,EAAkBC,GAErCqB,UAAU6C,WACZ7C,UAAU6C,WAAW1D,KAAKC,IAAK0D,KAAKC,UAAU5D,KAAKK,cADrD,CAKA,IAAIwD,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAQ/D,KAAKC,KAAK,GAC3B4D,EAAIJ,KAAKE,KAAKC,UAAU5D,KAAKK,YCZ/B,IAAIwB,EAAW,8BACXC,EAAW,yBCzBXe,EAAU,QA2BdD,EAAOY,UAAUC,KAAO,SAASjE,GAG/B,GAFAQ,KAAKK,QAAQ+C,UAAUC,OAAOW,KAAKzC,EAAiB/B,IAEhDqB,UAAU6C,WACZ7C,UAAU6C,WAAW1D,KAAKC,IAAK0D,KAAKC,UAAU5D,KAAKK,cADrD,CAKAT,QAAQC,IAAI,SAAUG,KAAKK,SAE3B,IAAIwD,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAQ/D,KAAKC,KAAK,GAC3B4D,EAAIJ,KAAKE,KAAKC,UAAU5D,KAAKK,+BChCxB,SAA0BN,GAC/B,IAAIkE,EAAK,IAAInE,EAAYC,GACzB,IACE,MAAM,IAAIuB,MAAM,kBAChB,MAAM9B,GACNyE,EAAGR,KAAKjE,aAIZ,SAAsB2B,GACpBE,EAAMF,kBAGR,SAA4BpB,EAAQmE,GAClC,IAAIC,EAAK,IAAIvB,EAAO7C,GACpB,IACEH,QAAQC,IAAI,SACZwB,EAAM6C,GACN,MAAM1E,GACNI,QAAQC,IAAI,MAAOL,GACnB2E,EAAGV,KAAKjE"}
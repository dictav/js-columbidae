{"version":3,"file":"columbidae.js","sources":["../src/util.js","../src/sentry.js","../src/main.js"],"sourcesContent":["\nexport function sendBeacon(url, data) {\n  if ('undefined' !== typeof navigator.sendBeacon) {\n    return navigator.sendBeacon(url, data);\n  }\n\n  var Request = /*@cc_on @if (@_jscript_version < 10) window.XDomainRequest || @end @*/ window.XMLHttpRequest;\n  if ('undefined' === typeof Request) {\n    return flase;\n  }\n\n  var xhr = new Request();\n\n  xhr.open(\"POST\", url, true);\n  xhr.send(data);\n\n  return true;\n}\n\n// it's not able to extaract from IE8 and IE9\nexport function extractException(err) {\n  var stacktrace = null;\n  if ('string' === typeof err.stack) {\n    stacktrace = parseStack(err.stack);\n  }\n\n  return {\n    type: 'Error',\n    value: err.message,\n    stacktrace: stacktrace\n  };\n}\n\nvar v8regexp = /at(.*) \\(?(.+):(\\d+):(\\d+)/g;\nvar ffregexp = /(.*)@(.+):(\\d+):(\\d+)/g;\nexport function parseStack(stack) {\n  var frames = [];\n  [v8regexp, ffregexp].forEach(function(r){\n    if (frames.length > 0) {\n      return;\n    }\n\n    var m = null;\n    while((m = r.exec(stack)) != null) {\n      var funcname = m[1].trim();\n      if (funcname.length == 0) {\n        funcname = '?';\n      }\n\n      frames.unshift({\n        function: funcname,\n        filename: m[2],\n        lineno: parseInt(m[3]),\n        colno: parseInt(m[4])\n      });\n    }\n  })\n\n  if (frames.length == 0) {\n    return null;\n  }\n\n  return { frames: frames };\n}\n","import { extractException, sendBeacon } from './util';\n\nimport { version } from '../package.json';\n\nfunction Sentry(config) {\n  // memo: IE8 @_jscript_version == 5.8, IE10 @_jscript_version == 10\n  // Sentry.io supports https only.\n  // - XDomainRequest can not send to different protocol. \n  // - XMLHttpRequest on Edge v15 can not send to different protocol. \n  /*@cc_on\n  @if (@_jscript_version < 5.8) throw new Error('This library does not support IE8-'); @end\n  @if (@_jscript_version < 10) if (window.location.protocol !== 'https:') throw new Error('Sentry.io supports https only'); @end\n  @*/\n\n  if ('undefined' === typeof config.uuidv4) {\n    throw new Error('uuidv4 is required');\n  }\n\n  this.start = (new Date()).getTime();\n  this.uuidv4 = config.uuidv4;\n  this.sendBeacon = config.sendBeacon;\n  this.url = \"//sentry.io/api/\" + config.projectId + \"/store/\"\n    + \"?sentry_version=7\"\n    + \"&sentry_client=ColumbidaeJS%2F\" + version\n    + \"&sentry_key=\" + config.key;\n  this.payload = {\n    project: config.projectId,\n    logger: 'javascript',\n    platform: 'javascript',\n    request: {\n      headers: {\n        'User-Agent': navigator.userAgent,\n      },\n      url: window.location.href\n    },\n    exception: {\n      values: []\n    },\n    extra: {\n      'session:duration': 0\n    }\n  }\n\n  if (typeof config.release === 'string') {\n    this.payload.release = config.release;\n  }\n}\n\nSentry.prototype.send = function(err) {\n  var id = this.uuidv4();\n  this.payload.exception.values.push(extractException(err));\n  this.payload.extra['session:duration'] = (new Date()).getTime() - this.start;\n  this.payload.event_id = id;\n\n  sendBeacon(this.url, JSON.stringify(this.payload));\n  return id;\n}\n\nexport default Sentry;\n","//export Stackdriver from './stackdriver'\nimport Sentry from './sentry';\nexport default {\n  Sentry: Sentry\n};\n"],"names":[],"mappings":"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"}
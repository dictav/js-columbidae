{"version":3,"file":"columbidae.js","sources":["../src/util.js","../src/sentry.js","../src/main.js"],"sourcesContent":["\nexport function sendBeacon(url, data) {\n  if ('undefined' !== typeof navigator.sendBeacon) {\n    return navigator.sendBeacon(url, data);\n  }\n\n  var Request = /*@cc_on @if (@_jscript_version < 10) window.XDomainRequest || @end @*/ window.XMLHttpRequest;\n  if ('undefined' === typeof Request) {\n    return flase;\n  }\n\n  var xhr = new Request();\n\n  xhr.open(\"POST\", url, true);\n  xhr.send(data);\n\n  return true;\n}\n\n// it's not able to extaract from IE8 and IE9\nexport function extractException(err) {\n  var stacktrace = null;\n  if ('string' === typeof err.stack) {\n    stacktrace = parseStack(err.stack);\n  }\n\n  return {\n    type: 'Error',\n    value: err.message,\n    stacktrace: stacktrace\n  };\n}\n\nvar v8regexp = /at(.*) \\(?(.+):(\\d+):(\\d+)/g;\nvar ffregexp = /(.*)@(.+):(\\d+):(\\d+)/g;\nexport function parseStack(stack) {\n  var frames = [];\n  [v8regexp, ffregexp].forEach(function(r){\n    if (frames.length > 0) {\n      return;\n    }\n\n    var m = null;\n    while((m = r.exec(stack)) != null) {\n      var funcname = m[1].trim();\n      if (funcname.length == 0) {\n        funcname = '?';\n      }\n\n      frames.unshift({\n        function: funcname,\n        filename: m[2],\n        lineno: parseInt(m[3]),\n        colno: parseInt(m[4])\n      });\n    }\n  })\n\n  if (frames.length == 0) {\n    return null;\n  }\n\n  return { frames: frames };\n}\n","import { extractException, sendBeacon } from './util';\n\nimport { version } from '../package.json';\n\nfunction Sentry(config) {\n  // memo: IE8 @_jscript_version == 5.8, IE10 @_jscript_version == 10\n  // Sentry.io supports https only.\n  // - XDomainRequest can not send to different protocol. \n  // - XMLHttpRequest on Edge v15 can not send to different protocol. \n  /*@cc_on\n  @if (@_jscript_version < 5.8) throw new Error('This library does not support IE8-'); @end\n  @if (@_jscript_version < 10) if (window.location.protocol !== 'https:') throw new Error('Sentry.io supports https only'); @end\n  @*/\n\n  if ('undefined' === typeof config.uuidv4) {\n    throw new Error('uuidv4 is required');\n  }\n\n  this.start = (new Date()).getTime();\n  this.uuidv4 = config.uuidv4;\n  this.sendBeacon = config.sendBeacon;\n  this.url = \"//sentry.io/api/\" + config.projectId + \"/store/\"\n    + \"?sentry_version=7\"\n    + \"&sentry_client=ColumbidaeJS%2F\" + version\n    + \"&sentry_key=\" + config.key;\n  this.payload = {\n    project: config.projectId,\n    logger: 'javascript',\n    platform: 'javascript',\n    request: {\n      headers: {\n        'User-Agent': navigator.userAgent,\n      },\n      url: window.location.href\n    },\n    exception: {\n      values: []\n    },\n    extra: {\n      'session:duration': 0\n    }\n  }\n}\n\nSentry.prototype.send = function(err) {\n  var id = this.uuidv4();\n  this.payload.exception.values.push(extractException(err));\n  this.payload.extra['session:duration'] = (new Date()).getTime() - this.start;\n  this.payload.event_id = id;\n\n  sendBeacon(this.url, JSON.stringify(this.payload));\n  return id;\n}\n\nexport default Sentry;\n","//export Stackdriver from './stackdriver'\nimport Sentry from './sentry';\nexport default {\n  Sentry: Sentry\n};\n"],"names":["sendBeacon","url","data","navigator","Request","window","XMLHttpRequest","flase","xhr","open","send","extractException","err","stacktrace","stack","parseStack","type","value","message","frames","v8regexp","ffregexp","forEach","r","length","m","exec","funcname","trim","unshift","function","filename","lineno","parseInt","colno","Sentry","config","uuidv4","Error","this","start","Date","getTime","projectId","version","key","payload","project","logger","platform","request","headers","User-Agent","userAgent","location","href","exception","values","extra","session:duration","prototype","id","push","event_id","JSON","stringify"],"mappings":"wLACO,SAASA,EAAWC,EAAKC,GAC9B,GAAI,oBAAuBC,UAAUH,WACnC,OAAOG,UAAUH,WAAWC,EAAKC,GAGnC,IAAIE,yEAAkFC,OAAOC,eAC7F,QAAI,IAAuBF,EACzB,OAAOG,MAGT,IAAIC,EAAM,IAAIJ,EAKd,OAHAI,EAAIC,KAAK,OAAQR,GAAK,GACtBO,EAAIE,KAAKR,IAEF,EAIT,SAAgBS,EAAiBC,GAC/B,IAAIC,EAAa,KAKjB,MAJI,iBAAoBD,EAAIE,QAC1BD,EAAaE,EAAWH,EAAIE,SAI5BE,KAAM,QACNC,MAAOL,EAAIM,QACXL,WAAYA,GAMhB,SAAgBE,EAAWD,GACzB,IAAIK,KAsBJ,OArBCC,EAAUC,GAAUC,QAAQ,SAASC,GACpC,KAAIJ,EAAOK,OAAS,GAKpB,IADA,IAAIC,EAAI,KACqB,OAAtBA,EAAIF,EAAEG,KAAKZ,KAAiB,CACjC,IAAIa,EAAWF,EAAE,GAAGG,OACG,GAAnBD,EAASH,SACXG,EAAW,KAGbR,EAAOU,SACLC,WAAUH,EACVI,SAAUN,EAAE,GACZO,OAAQC,SAASR,EAAE,IACnBS,MAAOD,SAASR,EAAE,SAKH,GAAjBN,EAAOK,OACF,MAGAL,OAAQA,GC1DnB,SAASgB,EAAOC;;;;AAUd,GAAI,oBAAuBA,EAAOC,OAChC,MAAM,IAAIC,MAAM,sBAGlBC,KAAKC,OAAQ,IAAKC,MAAQC,UAC1BH,KAAKF,OAASD,EAAOC,OACrBE,KAAKvC,WAAaoC,EAAOpC,WACzBuC,KAAKtC,IAAM,mBAAqBmC,EAAOO,UAAY,yDAEZC,EACnC,eAAiBR,EAAOS,IAC5BN,KAAKO,SACHC,QAASX,EAAOO,UAChBK,OAAQ,aACRC,SAAU,aACVC,SACEC,SACEC,aAAcjD,UAAUkD,WAE1BpD,IAAKI,OAAOiD,SAASC,MAEvBC,WACEC,WAEFC,OACEC,mBAAoB,IDN1B,IAAIvC,EAAW,8BACXC,EAAW,0CCUfc,EAAOyB,UAAUlD,KAAO,SAASE,GAC/B,IAAIiD,EAAKtB,KAAKF,SAMd,OALAE,KAAKO,QAAQU,UAAUC,OAAOK,KAAKnD,EAAiBC,IACpD2B,KAAKO,QAAQY,MAAM,qBAAsB,IAAKjB,MAAQC,UAAYH,KAAKC,MACvED,KAAKO,QAAQiB,SAAWF,EAExB7D,EAAWuC,KAAKtC,IAAK+D,KAAKC,UAAU1B,KAAKO,UAClCe,IChDP1B,OAAQA"}